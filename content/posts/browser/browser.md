---
title: "多进程的浏览器"
date: 2022-08-02T17:30:41+08:00
draft: false
tags: [""]
categories: [""]
typora-root-url: ..\..\static
---



一个浏览器是多进程，1 个浏览器（Browser）主进程、1 个 GPU 进程、1 个网络（NetWork Service）进程、多个渲染进程和多个插件进程。：
1. 浏览器（Brower）进程：浏览器的主进程，负责浏览器的协调、主控。如
    1. 负责浏览器界面显示，与用户交互。如前进、后退等。
    2. 负责个页面的进程管理。
    3. 网络资源的管理、下载。
2. 页面渲染进程：每个页面一个进程，互不影响。
3. GPU进程：最多一个，用于3D绘制。
4. 网络（NetWork Service）进程：负责⻚⾯的⽹络资源加载，比如在地址栏输入一个网页地址，网络进程会将请求后得到的资源交给渲染进程处理。
5. 第三方插件进程：每个插件对应一个进程。

## 多进程优势

1. 避免单个页面或插件影响到整个浏览器。
2. 多进程充分利用多核优势。
坏处就是内存消耗大。

## 浏览器内核（渲染进程）
1. GUI渲染线程
    - 主要负责页面的渲染，解析HTML、CSS，构建DOM树，布局和绘制等。
    - 当界面需要重绘或者由于某种操作引发回流时，将执行该线程。
    - 该线程与JS引擎线程互斥，当执行JS引擎线程时，GUI渲染会被挂起，当任务队列空闲时，主线程才会去执行GUI渲染。
2. JS引擎线程
    - 该线程负责处理 JavaScript脚本，执行代码。
    - 也是主要负责执行准备好待执行的事件，即定时器计数结束，或者异步请求成功并正确返回时，将依次进入任务队列，等待 JS引擎线程的执行。
    - 当然，该线程与 GUI渲染线程互斥，当 JS引擎线程执行 JavaScript脚本时间过长，将导致页面渲染的阻塞。
3. 事件触发线程
    - 主要负责维护任务队列，将准备好的事件交给 JS引擎线程执行。
    - 比如 setTimeout定时器计数结束， ajax等异步请求成功并触发回调函数，或者用户触发点击事件时，该线程会将整装待发的事件依次加入到任务队列的队尾，等待 JS引擎线程的执行。
4. 定时触发器线程
    - 负责执行异步定时器一类的函数的线程，如： setTimeout，setInterval。
    - 主线程依次执行代码时，遇到定时器，会将定时器交给该线程处理，当计数完毕后，事件触发线程会将计数完毕后的事件加入到任务队列的尾部，等待JS引擎线程执行。
5. 异步http请求线程
    - 每个http请求都会新开一个线程请求。
    - 负责执行异步请求一类的函数的线程，如： Promise，axios，ajax等。

> GUI渲染线程与JS引擎线程是互斥的，当JS引擎执行时GUI线程会被挂起（相当于被冻结了），GUI更新会被保存在一个队列中等到JS引擎空闲时立即被执行。

![image](/images/1460000012925880.png) 



## 面试题

### 打开一个页面会有多少个进程？

浏览器从关闭状态进行启动，然后新开 1 个页面至少需要 1 个网络进程、1 个浏览器进程、1 个 GPU 进程以及 1 个渲染进程，共 4 个进程；后续再新开标签页，浏览器、网络进程、GPU进程是共享的，不会重新启动，如果2个页面属于同一站点的话，并且从a页面中打开的b页面，那么他们也会共用一个渲染进程，否则新开一个渲染进程。

最新的 Chrome 浏览器包括：1 个浏览器（Browser）主进程、1 个 GPU 进程、1 个网络（NetWork）进程、多个渲染进程和多个插件进程。

- `浏览器进程`：主要负责界面显示、用户交互、子进程管理，同时提供存储等功能。
- `渲染进程`：核心任务是将 HTML、CSS 和 JavaScript 转换为用户可以与之交互的网页，排版引擎 Blink 和 JavaScript 引擎 V8 都是运行在该进程中，默认情况下，Chrome 会为每个 Tab 标签创建一个渲染进程。出于安全考虑，渲染进程都是运行在沙箱模式下。
- `GPU 进程`：其实，Chrome 刚开始发布的时候是没有 GPU 进程的。而 GPU 的使用初衷是为了实现 3D CSS 的效果，只是随后网页、Chrome 的 UI 界面都选择采用 GPU 来绘制，这使得 GPU 成为浏览器普遍的需求。最后，Chrome 在其多进程架构上也引入了 GPU 进程。
- `网络进程`：主要负责页面的网络资源加载，之前是作为一个模块运行在浏览器进程里面的，直至最近才独立出来，成为一个单独的进程。
- `插件进程`：主要是负责插件的运行，因插件易崩溃，所以需要通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响。





> 详解
>
> [JavaScript与浏览器 - 线程与引擎](https://lq782655835.github.io/blogs/js/http-base-2.browser.html)
>
> [从浏览器多进程到JS单线程，JS运行机制最全面的一次梳理](https://segmentfault.com/a/1190000012925872)
>
> [[浏览器工作原理与实践]](https://blog.poetries.top/browser-working-principle/guide/part1/lesson01.html#%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B)